<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:decorate xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:p="http://primefaces.org/ui"
             xmlns:ui="http://xmlns.jcp.org/jsf/facelets" template="template.xhtml"
             xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:form>
        <div style="padding: 5px; background: #ddd; border: 1px solid #aaa;border-radius: 3px">

            <p:growl id="messages" showDetail="true" sticky="false"/>

            <!--PAINEL DE ACORDEOES / CONTAINER EMPILHADOS-->

            <p:fieldset legend="Identificação do Paciente" style="background: #eee">

                <!-- <p:poll  interval="8" update="{usuarioBean.listar()}"/> -->

                <p:panelGrid class="panelForm" styleClass="panelColumns" style="margin: 0 auto;">
                    <p:row>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="pac" value="PAC:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="nome" value="Nome:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="apelido" value="Apelido:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="sexo" value="Sexo:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="contacto" value="Contacto:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="morada" value="Morada:"/>
                        </p:column>
                    </p:row>
                    <p:row class="panelLinha" style="background: #ddd">
                        <p:column style="background: #eee; border: none">
                            <p:selectOneMenu style="width: 185px" filter="true" filterMatchMode="startsWith" id="pac" value="#{prescricaoBean.prescricao.pac}">
                                <f:selectItems value="#{prescricaoBean.pacs}" />
                            </p:selectOneMenu>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="nome" style="width: 185px" maxlength="25" disabled="true" value="#{prescricaoBean.prescricao.nome}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="apelido" style="width: 185px" maxlength="25" disabled="true"  value="#{prescricaoBean.prescricao.apelido}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="sexo" style="width: 185px" maxlength="30" disabled="true"  value="#{prescricaoBean.prescricao.sexo}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="contacto" style="width: 185px" maxlength="30" disabled="true"  value="#{prescricaoBean.prescricao.contacto}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="morada" style="width: 185px" maxlength="30" disabled="true"  value="#{prescricaoBean.prescricao.morada}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>

                <br/>
                <p:toolbar>
                    <p:toolbarGroup align="left">
                        <p:commandButton icon="fa fa-check" value="&nbsp;Confirmar" actionListener="#{prescricaoBean.confirmar(prescricaoBean.prescricao.pac, usuarioBean.usuario.confIdUsuario)}" ajax="true" update="@form"></p:commandButton>
                    </p:toolbarGroup>
                </p:toolbar>
                <br/>
            </p:fieldset>

            <br/>
            <p:fieldset legend="Prescrição" style="background: #eee">
                <p:panelGrid class="panelForm" styleClass="panelColumns" style="margin: 0 auto;">
                    <p:row>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="prescricao" value="Prescrição:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="posologia" value="Posologia:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="quantidade" value="Quantidade:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="data" value="Data:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="clinico" value="O Clínico:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="contClinico" value="Contacto (Clínico):"/>
                        </p:column>
                    </p:row>
                    <p:row class="panelLinha" style="background: #ddd">

                        <p:column style="background: #eee; border: none">
                            <p:selectOneMenu filter="true" style="width: 185px" filterMatchMode="startsWith" id="prescricao" value="#{prescricaoBean.medicament}">
                                <f:selectItems value="#{prescricaoBean.presc}" />
                            </p:selectOneMenu>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:selectOneMenu filter="true" style="width: 185px" filterMatchMode="startsWith" id="posologia" value="#{prescricaoBean.posologia}">
                                <f:selectItems value="#{prescricaoBean.pos}" />
                            </p:selectOneMenu>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="quantidade" style="width: 185px" value="#{prescricaoBean.quantidade}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="data" style="width: 185px" maxlength="30" disabled="true"  value="#{prescricaoBean.prescricao.data}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="clinico" style="width: 185px" maxlength="30" disabled="true"  value="#{usuarioBean.usuario.confNome}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="contClinico" style="width: 185px" maxlength="30" disabled="true"  value="#{usuarioBean.usuario.confContacto}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <br/>

                <p:toolbar>
                    <p:toolbarGroup align="left">
                        <p:commandButton icon="pi pi-file" value="&nbsp;Adicionar" actionListener="#{prescricaoBean.adicionarMedicamento()}" ajax="true" update="@form"></p:commandButton>
                    </p:toolbarGroup>
                </p:toolbar>

                <br/>

                <p:dataTable value="#{prescricaoBean.medicamentos}" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" selectionMode="single" rowKey="#{medicamento.ordem}"  rows="5" paginator="true" widgetVar="personTable" var="medicamento">
                    <p:column style="text-align: center" headerText="Operação" width="100">
                        <p:commandButton style="font-size: 17px" icon="fa fa-trash-o" actionListener="#{prescricaoBean.removerMedicamento(medicamento)}" update="@form"/>
                    </p:column>
                    <p:column headerText="Prescrição">
                        <h:outputText value="#{medicamento.medicament}"></h:outputText>
                    </p:column>
                    <p:column headerText="Posologia">
                        <h:outputText value="#{medicamento.posologia}"></h:outputText>
                    </p:column>
                    <p:column headerText="Quantidade">
                        <h:outputText value="#{medicamento.quantidade}"></h:outputText>
                    </p:column>
                </p:dataTable>
            </p:fieldset>
            <hr style="border: 0.5px solid #aaa"/>
            <p:toolbar>
                <p:toolbarGroup align="right">
                    <p:commandButton icon="fa fa-save" value="&nbsp;Gravar" actionListener="#{prescricaoBean.salvar(prescricaoBean.prescricao)}" ajax="true" update="@form"></p:commandButton>
                    <p:commandButton icon="fa fa-close" value="&nbsp;Cancelar" actionListener="#{prescricaoBean.cancelar(prescricaoBean.prescricao)}"  ajax="true" update="@form"></p:commandButton>
                </p:toolbarGroup>
            </p:toolbar>

        </div>

        <br/>
        <br/>
        <br/>

        <!--METODO DE TIMEOUT (RECARREGAMENTO DA PÁGINA PARA LOGIN-->
        <p:idleMonitor timeout="1200000">
            <p:ajax event="idle" listener="#{usuarioBean.reload()}" update="messages"/> 
        </p:idleMonitor>

    </h:form>

</ui:decorate>