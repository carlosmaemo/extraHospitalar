<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:decorate xmlns="http://www.w3.org/1999/xhtml"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:p="http://primefaces.org/ui"
             xmlns:ui="http://xmlns.jcp.org/jsf/facelets" template="template.xhtml"
             xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
             xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:form>

        <div style="padding: 5px; background: #ddd; border: 1px solid #aaa;border-radius: 3px">

            <!--PAINEL DE NOTIFICACAO-->

            <p:growl id="messages" showDetail="true" sticky="false"/>

            <!--DADOS DO PACIENTE-->

            <p:fieldset legend="Dados do Paciente" style="background: #eee">

                <p:panelGrid class="panelForm" styleClass="panelColumns">
                    <p:row>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="nidPaciente" value="NID:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="nomePaciente" value="Nome:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="apelidoPaciente" value="Apelido:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="contactoPaciente" value="Contacto:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="sexoPaciente" value="Sexo:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="empresaPaciente" value="Empresa:"/>
                        </p:column>
                    </p:row>
                    <p:row class="panelLinha" style="background: #ddd">
                        <p:column style="background: #eee; border: none">
                            <p:selectOneMenu style="width: 185px" filter="true" filterMatchMode="startsWith" id="nidPaciente" value="#{facturaBean.factura.nidPaciente}">
                                <f:selectItems value="#{facturaBean.nids}" />
                            </p:selectOneMenu>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="nomePaciente" style="width: 185px" maxlength="30" disabled="true" value="#{facturaBean.factura.nomePaciente}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="apelidoPaciente" style="width: 185px" maxlength="30" disabled="true"  value="#{facturaBean.factura.apelidoPaciente}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="contactoPaciente" style="width: 185px" maxlength="30" disabled="true"  value="#{facturaBean.factura.contactoPaciente}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="sexoPaciente" style="width: 185px" maxlength="30" disabled="true"  value="#{facturaBean.factura.sexoPaciente}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText id="empresaPaciente" style="width: 185px" maxlength="30" disabled="true"  value="#{facturaBean.factura.nomeEmpresa}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>

                <br/>
                <p:toolbar>
                    <p:toolbarGroup align="left">
                        <p:commandButton icon="fa fa-check" value="&nbsp;Confirmar" actionListener="#{facturaBean.confirmar(facturaBean.factura.nidPaciente, usuarioBean.usuario.confIdUsuario)}" ajax="true" update="@form"></p:commandButton>
                    </p:toolbarGroup>
                </p:toolbar>
            </p:fieldset>

            <hr style=""/>

            <!--PAINEL DE ACORDEOES / CONTAINER EMPILHADOS-->

            <p:accordionPanel multiple="true">

                <!--FACTURA CONSULTA-->

                <p:tab title="Consulta / Procedimento Médico">
                    <p:panelGrid class="panelForm" styleClass="panelColumns">
                        <p:row>
                            <p:column style="border: none">
                                <h:outputLabel for="consultaNome" value="Consulta/Procedimento:"/>
                            </p:column>
                            <p:column style="border: none">
                                <h:outputLabel for="consultaMedico" value="Médico:"/>
                            </p:column>
                        </p:row>
                        <p:row class="panelLinha" style="background: #ddd">
                            <p:column style="border: none">
                                <p:selectOneMenu id="consultaNome" filter="true" style="width: 185px" filterMatchMode="startsWith" value="#{facturaBean.consulta}">
                                    <f:selectItems value="#{facturaBean.consultas}" />
                                </p:selectOneMenu>
                            </p:column>
                            <p:column id="consultaMedico" style="border: none">
                                <p:selectOneMenu filter="true" style="width: 185px" filterMatchMode="startsWith" value="#{facturaBean.consultaMedico}">
                                    <f:selectItems value="#{facturaBean.medicos}" />
                                </p:selectOneMenu>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <br/>

                    <p:toolbar>
                        <p:toolbarGroup align="left">
                            <p:commandButton icon="pi pi-file" value="&nbsp;Adicionar" actionListener="#{facturaBean.adicionarConsulta()}" ajax="true" update="@form"></p:commandButton>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <br/>

                    <p:dataTable value="#{facturaBean.consultasTemp}" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" selectionMode="single" rowKey="#{consulta.ordem}"  rows="5" paginator="true" widgetVar="tblConsultas" var="consulta">
                        <p:column style="text-align: center" headerText="Operação" width="100">
                            <p:commandButton style="font-size: 17px" icon="fa fa-trash-o" actionListener="#{facturaBean.removerConsulta(consulta)}" update="@form"/>
                        </p:column>
                        <p:column headerText="Consulta/Procedimento">
                            <h:outputText value="#{consulta.consulta}"></h:outputText>
                        </p:column>
                        <p:column headerText="Data/Hora">
                            <h:outputText value="#{consulta.consultaData}"></h:outputText>
                        </p:column>
                        <p:column headerText="Médico">
                            <h:outputText value="#{consulta.consultaMedico}"></h:outputText>
                        </p:column>
                        <p:column headerText="Valor (MT)">
                            <h:outputText value="#{consulta.consultaValor}"></h:outputText>
                        </p:column>
                    </p:dataTable>

                </p:tab>

                <!--FACTURA EXAME-->

                <p:tab title="Exames médicos">
                    <p:panelGrid class="panelForm" styleClass="panelColumns">
                        <p:row>
                            <p:column style="border: none">
                                <h:outputLabel for="exameNome" value="Exame:"/>
                            </p:column>
                        </p:row>
                        <p:row class="panelLinha" style="background: #ddd">
                            <p:column style="border: none">
                                <p:selectOneMenu id="exameNome" filter="true" style="width: 185px" filterMatchMode="startsWith" value="#{facturaBean.exame}">
                                    <f:selectItems value="#{facturaBean.exames}" />
                                </p:selectOneMenu>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <br/>

                    <p:toolbar>
                        <p:toolbarGroup align="left">
                            <p:commandButton icon="pi pi-file" value="&nbsp;Adicionar" actionListener="#{facturaBean.adicionarExame()}" ajax="true" update="@form"></p:commandButton>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <br/>

                    <p:dataTable value="#{facturaBean.examesTemp}" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" selectionMode="single" rowKey="#{exame.ordem}"  rows="5" paginator="true" widgetVar="tblExames" var="exame">
                        <p:column style="text-align: center" headerText="Operação" width="100">
                            <p:commandButton style="font-size: 17px" icon="fa fa-trash-o" actionListener="#{facturaBean.removerExame(exame)}" update="@form"/>
                        </p:column>
                        <p:column headerText="Exame">
                            <h:outputText value="#{exame.exame}"></h:outputText>
                        </p:column>
                        <p:column headerText="Data/Hora">
                            <h:outputText value="#{exame.exameData}"></h:outputText>
                        </p:column>
                        <p:column headerText="Categoria">
                            <h:outputText value="#{exame.exameCategoria}"></h:outputText>
                        </p:column>
                        <p:column headerText="Valor (MT)">
                            <h:outputText value="#{exame.exameValor}"></h:outputText>
                        </p:column>
                    </p:dataTable>

                </p:tab>

                <!--FACTURA INTERNAMENTO-->

                <p:tab title="Internamentos">
                    <p:panelGrid class="panelForm" styleClass="panelColumns">
                        <p:row>
                            <p:column style="border: none">
                                <h:outputLabel for="internamentoNome" value="Internamento:"/>
                            </p:column>
                        </p:row>
                        <p:row class="panelLinha" style="background: #ddd">
                            <p:column style="border: none">
                                <p:selectOneMenu id="internamentoNome" filter="true" style="width: 185px" filterMatchMode="startsWith" value="#{facturaBean.internamento}">
                                    <f:selectItems value="#{facturaBean.internamentos}" />
                                </p:selectOneMenu>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <br/>

                    <p:toolbar>
                        <p:toolbarGroup align="left">
                            <p:commandButton icon="pi pi-file" value="&nbsp;Adicionar" actionListener="#{facturaBean.adicionarInternamento()}" ajax="true" update="@form"></p:commandButton>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <br/>

                    <p:dataTable value="#{facturaBean.internamentosTemp}" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" selectionMode="single" rowKey="#{internamento.ordem}"  rows="5" paginator="true" widgetVar="tblInternamentos" var="internamento">
                        <p:column style="text-align: center" headerText="Operação" width="100">
                            <p:commandButton style="font-size: 17px" icon="fa fa-trash-o" actionListener="#{facturaBean.removerInternamento(internamento)}" update="@form"/>
                        </p:column>
                        <p:column headerText="Internamento">
                            <h:outputText value="#{internamento.internamento}"></h:outputText>
                        </p:column>
                        <p:column headerText="Data/Hora">
                            <h:outputText value="#{internamento.internamentoData}"></h:outputText>
                        </p:column>
                        <p:column headerText="Tempo">
                            <h:outputText value="#{internamento.internamentoTempo}"></h:outputText>
                        </p:column>
                        <p:column headerText="Valor (MT)">
                            <h:outputText value="#{internamento.internamentoValor}"></h:outputText>
                        </p:column>
                    </p:dataTable>

                </p:tab>

                <!--FACTURA VISITA-->

                <p:tab title="Visitas">
                    <p:panelGrid class="panelForm" styleClass="panelColumns">
                        <p:row>
                            <p:column style="border: none">
                                <h:outputLabel for="visitaNome" value="Visita"/>
                            </p:column>
                        </p:row>
                        <p:row class="panelLinha" style="background: #ddd">
                            <p:column style="border: none">
                                <p:selectOneMenu id="visitaNome" filter="true" style="width: 185px" filterMatchMode="startsWith" value="#{facturaBean.visita}">
                                    <f:selectItems value="#{facturaBean.visitas}" />
                                </p:selectOneMenu>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <br/>

                    <p:toolbar>
                        <p:toolbarGroup align="left">
                            <p:commandButton icon="pi pi-file" value="&nbsp;Adicionar" actionListener="#{facturaBean.adicionarVisita()}" ajax="true" update="@form"></p:commandButton>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <br/>

                    <p:dataTable value="#{facturaBean.visitasTemp}" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" selectionMode="single" rowKey="#{visita.ordem}"  rows="5" paginator="true" widgetVar="tblVisitas" var="visita">
                        <p:column style="text-align: center" headerText="Operação" width="100">
                            <p:commandButton style="font-size: 17px" icon="fa fa-trash-o" actionListener="#{facturaBean.removerVisita(visita)}" update="@form"/>
                        </p:column>
                        <p:column headerText="Visita">
                            <h:outputText value="#{visita.visita}"></h:outputText>
                        </p:column>
                        <p:column headerText="Data">
                            <h:outputText value="#{visita.visitaData}"></h:outputText>
                        </p:column>
                        <p:column headerText="Tempo">
                            <h:outputText value="#{visita.visitaTempo}"></h:outputText>
                        </p:column>
                        <p:column headerText="Valor (MT)">
                            <h:outputText value="#{visita.visitaValor}"></h:outputText>
                        </p:column>
                    </p:dataTable>

                </p:tab>

                <!--FACTURA MEDICAMENTO-->

                <p:tab title="Medicamentos">
                    <p:panelGrid class="panelForm" styleClass="panelColumns">
                        <p:row>
                            <p:column style="border: none">
                                <h:outputLabel for="medicamentoNome" value="Medicamento:"/>
                            </p:column>
                        </p:row>
                        <p:row class="panelLinha" style="background: #ddd">
                            <p:column style="border: none">
                                <p:selectOneMenu id="medicamentoNome" filter="true" style="width: 185px" filterMatchMode="startsWith" value="#{facturaBean.medicamento}">
                                    <f:selectItems value="#{facturaBean.medicamentos}" />
                                </p:selectOneMenu>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <br/>

                    <p:toolbar>
                        <p:toolbarGroup align="left">
                            <p:commandButton icon="pi pi-file" value="&nbsp;Adicionar" actionListener="#{facturaBean.adicionarMedicamento()}" ajax="true" update="@form"></p:commandButton>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <br/>

                    <p:dataTable value="#{facturaBean.medicamentosTemp}" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" selectionMode="single" rowKey="#{medicamento.ordem}"  rows="5" paginator="true" widgetVar="tblMedicamentos" var="medicamento">
                        <p:column style="text-align: center" headerText="Operação" width="100">
                            <p:commandButton style="font-size: 17px" icon="fa fa-trash-o" actionListener="#{facturaBean.removerMedicamento(medicamento)}" update="@form"/>
                        </p:column>
                        <p:column headerText="Medicamento">
                            <h:outputText value="#{medicamento.medicamento}"></h:outputText>
                        </p:column>
                        <p:column headerText="Data/Hora">
                            <h:outputText value="#{medicamento.medicamentoData}"></h:outputText>
                        </p:column>
                        <p:column headerText="Categoria">
                            <h:outputText value="#{medicamento.medicamentoCategoria}"></h:outputText>
                        </p:column>
                        <p:column headerText="Valor (MT)">
                            <h:outputText value="#{medicamento.medicamentoValor}"></h:outputText>
                        </p:column>
                    </p:dataTable>

                </p:tab>

                <!--FACTURA CONSUMIVEIS-->

                <p:tab title="Consumíveis">
                    <p:panelGrid class="panelForm" styleClass="panelColumns">
                        <p:row>
                            <p:column style="border: none">
                                <h:outputLabel for="consumivelNome" value="Consumivel"/>
                            </p:column>
                        </p:row>
                        <p:row class="panelLinha" style="background: #ddd">
                            <p:column style="border: none">
                                <p:selectOneMenu id="consumivelNome" filter="true" style="width: 185px" filterMatchMode="startsWith" value="#{facturaBean.consumivel}">
                                    <f:selectItems value="#{facturaBean.consumiveis}" />
                                </p:selectOneMenu>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <br/>

                    <p:toolbar>
                        <p:toolbarGroup align="left">
                            <p:commandButton icon="pi pi-file" value="&nbsp;Adicionar" actionListener="#{facturaBean.adicionarConsumivel()}" ajax="true" update="@form"></p:commandButton>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <br/>

                    <p:dataTable value="#{facturaBean.consumiveisTemp}" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" selectionMode="single" rowKey="#{consumivel.ordem}"  rows="5" paginator="true" widgetVar="tblConsumiveis" var="consumivel">
                        <p:column style="text-align: center" headerText="Operação" width="100">
                            <p:commandButton style="font-size: 17px" icon="fa fa-trash-o" actionListener="#{facturaBean.removerConsumivel(consumivel)}" update="@form"/>
                        </p:column>
                        <p:column headerText="Consumivel">
                            <h:outputText value="#{consumivel.consumivel}"></h:outputText>
                        </p:column>
                        <p:column headerText="Data">
                            <h:outputText value="#{consumivel.consumivelData}"></h:outputText>
                        </p:column>
                        <p:column headerText="Categoria">
                            <h:outputText value="#{consumivel.consumivelCategoria}"></h:outputText>
                        </p:column>
                        <p:column headerText="Valor (MT)">
                            <h:outputText value="#{consumivel.consumivelValor}"></h:outputText>
                        </p:column>
                    </p:dataTable>

                </p:tab>

            </p:accordionPanel>

            <hr style=""/>

            <!--SALVAR FACTURA-->

            <p:toolbar>
                <p:toolbarGroup align="right">
                    <p:commandButton icon="fa fa-save" value="&nbsp;Gravar" actionListener="#{facturaBean.salvar(facturaBean.factura, usuarioBean.usuario.confIdUsuario)}" ajax="true" update="@form"></p:commandButton>
                    <p:commandButton icon="fa fa-close" value="&nbsp;Cancelar" actionListener="#{prescricaoBean.cancelar(facturaBean.factura)}"  ajax="true" update="@form"></p:commandButton>
                </p:toolbarGroup>
            </p:toolbar>

            <br/>

            <p:fieldset legend="Registros de factura" style="background: #eee">

                <p:panelGrid class="panelForm" styleClass="panelColumns">
                    <p:row>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="nidFiltro" value="NID:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="dataInicial" value="A partir de:"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <h:outputLabel for="dataFinal" value="Até:"/>
                        </p:column>
                    </p:row>
                    <p:row class="panelLinha" style="background: #ddd">
                        <p:column style="background: #eee; border: none">
                            <p:inputText a:placeholder="NID do paciente" id="nidFiltro" style="width: 185px" maxlength="30" value="#{facturaBean.factura.nidFiltro}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText a:placeholder="#{facturaBean.factura.dataHoje}" id="dataInicial" style="width: 185px" maxlength="30" value="#{facturaBean.factura.dataInicial}"/>
                        </p:column>
                        <p:column style="background: #eee; border: none">
                            <p:inputText a:placeholder="#{facturaBean.factura.dataHoje}" id="dataFinal" style="width: 185px" maxlength="25" value="#{facturaBean.factura.dataFinal}"/>
                        </p:column>
                    </p:row>
                </p:panelGrid>
                <br/>
                <p:toolbar>
                    <p:toolbarGroup align="left">
                        <p:commandButton icon="fa fa-search" value="&nbsp;Pesquisar" action="#{facturaBean.pesquisarFiltro()}" ajax="true" update="@form"></p:commandButton>
                        <p:commandButton icon="fa fa-close" value="&nbsp;Cancelar :: Mostrar tudo" action="#{facturaBean.cancelarFiltro()}" ajax="true" update="@form"></p:commandButton>
                    </p:toolbarGroup>
                </p:toolbar>
                <br/>

                <p:dataTable value="#{facturaBean.facturas}" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" selectionMode="single" rowKey="#{factura.idFactura}" rows="5" paginator="true" widgetVar="tblFacturas" var="factura">
                    <p:column style="text-align: center" headerText="Operação" width="100">
                        <p:commandButton style="font-size: 17px" icon="fa fa-print" actionListener="#{facturaBean.print(factura, usuarioBean.usuario.confIdUsuario)}" ajax="false" onclick="this.form.target = '_blank'" update="@form"/>
                        <p:commandButton style="font-size: 17px" icon="fa fa-trash-o" actionListener="#{facturaBean.deletar(factura)}" ajax="true" update="@form">
                            <p:confirm header="Confirmação" message="Deseja mesmo remover a factura?" icon="ui-icon-alert">
                            </p:confirm>
                        </p:commandButton>
                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton value="&nbsp;Sim" type="button" styleClass="ui-confirmdialog-yes" icon="fa fa-check" />
                            <p:commandButton value="&nbsp;Não" type="button" styleClass="ui-confirmdialog-no" icon="fa fa-close" />
                        </p:confirmDialog>
                    </p:column>
                    <p:column headerText="Data" sortBy="#{factura.data}">
                        <h:outputText value="#{factura.data}"></h:outputText>
                    </p:column>
                    <p:column headerText="NID" sortBy="#{factura.nidPaciente}">
                        <h:outputText value="#{factura.nidPaciente}"></h:outputText>
                    </p:column>
                    <p:column headerText="Nome Completo" sortBy="#{factura.nomePaciente}">
                        <h:outputText value="#{factura.nomePaciente}"></h:outputText>
                    </p:column>
                    <p:column headerText="O Clínico" sortBy="#{factura.nomeMedico}">
                        <h:outputText value="#{factura.nomeMedico}"></h:outputText>
                    </p:column>
                    <p:column headerText="O Administrativo" sortBy="#{factura.nomeUsuario}">
                        <h:outputText value="#{factura.nomeUsuario}"></h:outputText>
                    </p:column>
                    <p:column headerText="Valor Total (MT)" sortBy="#{factura.valorTotal}">
                        <h:outputText value="#{factura.valorTotal}"></h:outputText>
                    </p:column>
                </p:dataTable>
                <br/>
            </p:fieldset>
        </div>

        <br/>
        <br/>
        <br/>

        <!--METODO DE TIMEOUT (RECARREGAMENTO DA PÁGINA PARA LOGIN-->

        <p:idleMonitor timeout="1200000">
            <p:ajax event="idle" listener="#{usuarioBean.reload()}" update="messages"/> 
        </p:idleMonitor>

    </h:form>

</ui:decorate>